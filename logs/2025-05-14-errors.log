ERROR | app.services.workflow.manager | (logging.py:167) | Error processing message for 923408957390
State: WAITING_FOR_MEDIA_UPLOAD
Message: 'Received image with ID: 1139408681230448'

Traceback (most recent call last):
  File "/workspaces/elevate2ai/app/services/workflow/manager.py", line 104, in _message_processor
    media_url = await save_whatsapp_image(media_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: save_whatsapp_image() missing 1 required positional argument: 'client_id'

Stack:
  File "<string>", line 1, in <module>
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 671, in run_until_complete
    self.run_forever()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 638, in run_forever
    self._run_once()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 1971, in _run_once
    handle._run()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/workspaces/elevate2ai/app/services/workflow/manager.py", line 148, in _message_processor
    log_exception(self.logger, error_msg, e)
  File "/workspaces/elevate2ai/app/services/common/logging.py", line 167, in log_exception
    logger.error(f"{message}\n{tb_text}")
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1568, in error
    self._log(ERROR, msg, args, **kwargs)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1684, in _log
    self.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1700, in handle
    self.callHandlers(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1762, in callHandlers
    hdlr.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1028, in handle
    self.emit(record)

ERROR | app.services.messaging.client | (client.py:383) | Failed to send image to 923408957390: (#100) Param image['link'] is not a valid URI. (Code: 100)
Stack:
  File "<string>", line 1, in <module>
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 671, in run_until_complete
    self.run_forever()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 638, in run_forever
    self._run_once()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 1971, in _run_once
    handle._run()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/workspaces/elevate2ai/app/services/workflow/manager.py", line 174, in _message_processor
    await handler(client_id, message_text.strip().lower())
  File "/workspaces/elevate2ai/app/services/workflow/handlers/scheduling.py", line 22, in handle
    await self.send_confirmation_summary(client_id, context)
  File "/workspaces/elevate2ai/app/services/workflow/handlers/scheduling.py", line 99, in send_confirmation_summary
    await self.client.send_media(
  File "/workspaces/elevate2ai/app/services/messaging/client.py", line 184, in send_media
    response_data = await self._send_single_media_item(
  File "/workspaces/elevate2ai/app/services/messaging/client.py", line 231, in _send_single_media_item
    self._handle_api_error(response_data, phone_number, media_type)
  File "/workspaces/elevate2ai/app/services/messaging/client.py", line 383, in _handle_api_error
    self.logger.error(
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1568, in error
    self._log(ERROR, msg, args, **kwargs)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1684, in _log
    self.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1700, in handle
    self.callHandlers(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1762, in callHandlers
    hdlr.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1028, in handle
    self.emit(record)

ERROR | app.services.content.switchboard | (switchboard.py:174) | HTTP error generating image: Client error '400 Bad Request' for url 'https://api.canvas.switchboard.ai'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
Stack:
  File "<string>", line 1, in <module>
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 671, in run_until_complete
    self.run_forever()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 638, in run_forever
    self._run_once()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 1971, in _run_once
    handle._run()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/workspaces/elevate2ai/app/services/workflow/manager.py", line 174, in _message_processor
    await handler(client_id, message_text.strip().lower())
  File "/workspaces/elevate2ai/app/services/workflow/handlers/execution.py", line 51, in handle_confirmation
    await self.generate_platform_images(client_id)
  File "/workspaces/elevate2ai/app/services/workflow/handlers/execution.py", line 252, in generate_platform_images
    image_response = create_image(
  File "/workspaces/elevate2ai/app/services/content/switchboard.py", line 206, in create_image
    response = canvas.generate_image(payload)
  File "/workspaces/elevate2ai/app/services/content/switchboard.py", line 174, in generate_image
    self.logger.error(f"HTTP error generating image: {e}")
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1568, in error
    self._log(ERROR, msg, args, **kwargs)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1684, in _log
    self.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1700, in handle
    self.callHandlers(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1762, in callHandlers
    hdlr.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1028, in handle
    self.emit(record)

ERROR | create_image | (switchboard.py:209) | Failed to create image: Client error '400 Bad Request' for url 'https://api.canvas.switchboard.ai'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
Stack:
  File "<string>", line 1, in <module>
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 671, in run_until_complete
    self.run_forever()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 638, in run_forever
    self._run_once()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 1971, in _run_once
    handle._run()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/workspaces/elevate2ai/app/services/workflow/manager.py", line 174, in _message_processor
    await handler(client_id, message_text.strip().lower())
  File "/workspaces/elevate2ai/app/services/workflow/handlers/execution.py", line 51, in handle_confirmation
    await self.generate_platform_images(client_id)
  File "/workspaces/elevate2ai/app/services/workflow/handlers/execution.py", line 252, in generate_platform_images
    image_response = create_image(
  File "/workspaces/elevate2ai/app/services/content/switchboard.py", line 209, in create_image
    logger.error(f"Failed to create image: {e}")
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1568, in error
    self._log(ERROR, msg, args, **kwargs)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1684, in _log
    self.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1700, in handle
    self.callHandlers(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1762, in callHandlers
    hdlr.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1028, in handle
    self.emit(record)

ERROR | app.services.workflow.handlers.base | (execution.py:275) | Error generating image for instagram: Client error '400 Bad Request' for url 'https://api.canvas.switchboard.ai'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
Stack:
  File "<string>", line 1, in <module>
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 671, in run_until_complete
    self.run_forever()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 638, in run_forever
    self._run_once()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 1971, in _run_once
    handle._run()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/workspaces/elevate2ai/app/services/workflow/manager.py", line 174, in _message_processor
    await handler(client_id, message_text.strip().lower())
  File "/workspaces/elevate2ai/app/services/workflow/handlers/execution.py", line 51, in handle_confirmation
    await self.generate_platform_images(client_id)
  File "/workspaces/elevate2ai/app/services/workflow/handlers/execution.py", line 275, in generate_platform_images
    self.logger.error(
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1568, in error
    self._log(ERROR, msg, args, **kwargs)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1684, in _log
    self.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1700, in handle
    self.callHandlers(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1762, in callHandlers
    hdlr.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1028, in handle
    self.emit(record)

ERROR | app.services.messaging.client | (client.py:383) | Failed to send image to 923408957390: (#100) Param image['link'] is not a valid URI. (Code: 100)
Stack:
  File "<string>", line 1, in <module>
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/home/codespace/.python/current/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/workspaces/elevate2ai/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 671, in run_until_complete
    self.run_forever()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 638, in run_forever
    self._run_once()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 1971, in _run_once
    handle._run()
  File "/home/codespace/.python/current/lib/python3.12/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/workspaces/elevate2ai/app/services/workflow/manager.py", line 174, in _message_processor
    await handler(client_id, message_text.strip().lower())
  File "/workspaces/elevate2ai/app/services/workflow/handlers/execution.py", line 51, in handle_confirmation
    await self.generate_platform_images(client_id)
  File "/workspaces/elevate2ai/app/services/workflow/handlers/execution.py", line 287, in generate_platform_images
    await self.client.send_media(
  File "/workspaces/elevate2ai/app/services/messaging/client.py", line 184, in send_media
    response_data = await self._send_single_media_item(
  File "/workspaces/elevate2ai/app/services/messaging/client.py", line 231, in _send_single_media_item
    self._handle_api_error(response_data, phone_number, media_type)
  File "/workspaces/elevate2ai/app/services/messaging/client.py", line 383, in _handle_api_error
    self.logger.error(
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1568, in error
    self._log(ERROR, msg, args, **kwargs)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1684, in _log
    self.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1700, in handle
    self.callHandlers(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1762, in callHandlers
    hdlr.handle(record)
  File "/home/codespace/.python/current/lib/python3.12/logging/__init__.py", line 1028, in handle
    self.emit(record)

